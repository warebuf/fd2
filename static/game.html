<html lang="en">
<head>
    <title>.</title>
    <style>
        * {
            border: 1px solid pink;
            margin: 0px;
            padding: 0px;
        }
        body {
            height:100%;
            margin: 0;
            overflow: hidden;
        }

        #container {
            position:relative;
        }

        #test {
            position: absolute;
            padding: 0px;
            text-align: center;
            max-width: 100%;
            width: 100%;
            margin-left:auto;
            margin-right:auto;
            top:50%;
            left:50%;
            transform:translate(-50%,-50%);
        }

        #messages {
            position: absolute;
            padding: 0px;
            text-align: center;
            max-width: 100%;
            width: 100%;
            margin-left:auto;
            margin-right:auto;
            top:60%;
            left:50%;
            transform:translate(-50%,-50%);
        }

    </style>
</head>


<body>

<div id="container">

    <div id="test">
        <p>{{.mid}}</p>
    </div>

    <ul id="messages"></ul>

    <canvas id="myCanvas"></canvas>

</div>



<script src="https://cdn.socket.io/socket.io-3.0.5.js"></script>
<script src="/static/engine.js"></script>

<script>
    var socket = null;
    var startCount = null;

    function test() {

        var messages = document.getElementById("messages")

        if (!window["WebSocket"]) {
            alert("Error: Your browser does not support web sockets.")
        } else {
            socket = new WebSocket("ws://{{.host}}/ingame?matchid={{.mid}}");
            socket.onclose = function() {
                alert("Connection has been closed.");
            }

            socket.onmessage = function(e) {
                var receive_time = Date.now().toLocaleString('en-CH')
                var msg = eval('('+e.data+')');
                console.log(msg.Event, msg.Name, msg.MatchID, msg.Message);

                var msg_date = msg.When.substring(0,10);
                var msg_time = msg.When.substring(11,19);

                if(msg.Event == 'clockSyncRequest') {
                    console.log("recieve time", receive_time)
                    console.log("actual time", msg.When)
                }
                else if(msg.Event == 'entered') {
                    var li = document.createElement("li");
                    li.appendChild(document.createTextNode(msg_date + ' ' + msg_time + ' ' + msg.Name + ' has entered the game'));
                    messages.appendChild(li);
                }
                else if(msg.Event == 'left') {
                    var li = document.createElement("li");
                    li.appendChild(document.createTextNode(msg_date + ' ' + msg_time + ' ' + msg.Name + ' has left the game'));
                    messages.appendChild(li);
                }
                else if(msg.Event == 'startMatchCountdown') {
                    startCount = Date.parse(msg.Message)
                }
                else if(msg.Event == 'turn') {
                    startCount = Date.parse(msg.Message)
                }
            }
        }
    }
    test()




</script>
</body>
</html>
